% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/gkwreg-core.R
\name{gkwreg}
\alias{gkwreg}
\title{Fit Generalized Kumaraswamy Regression Models}
\usage{
gkwreg(
  formula,
  data,
  family = c("gkw", "bkw", "kkw", "ekw", "mc", "kw", "beta"),
  link = NULL,
  link_scale = NULL,
  subset = NULL,
  weights = NULL,
  offset = NULL,
  na.action = getOption("na.action"),
  contrasts = NULL,
  control = gkw_control(),
  model = TRUE,
  x = FALSE,
  y = TRUE,
  ...
)
}
\arguments{
\item{formula}{An object of class \code{\link[Formula]{Formula}}. The formula
uses extended syntax to specify different linear predictors for each
parameter:
\code{y ~ model_alpha | model_beta | model_gamma | model_delta | model_lambda}

\describe{
\item{\code{y}}{The response variable, which must be in the (0, 1) interval.}
\item{\code{model_alpha}}{Predictors for the \eqn{\alpha} parameter.}
\item{\code{model_beta}}{Predictors for the \eqn{\beta} parameter.}
\item{\code{model_gamma}}{Predictors for the \eqn{\gamma} parameter.}
\item{\code{model_delta}}{Predictors for the \eqn{\delta} parameter.}
\item{\code{model_lambda}}{Predictors for the \eqn{\lambda} parameter.}
}
See Details for examples.}

\item{data}{A data frame containing the variables specified in \code{formula}.}

\item{family}{A character string specifying the distribution family. Must be one of:
\describe{
\item{\code{"gkw"}}{Generalized Kumaraswamy (default). Parameters:
\eqn{\alpha, \beta, \gamma, \delta, \lambda}.}
\item{\code{"bkw"}}{Beta-Kumaraswamy. Parameters:
\eqn{\alpha, \beta, \gamma, \delta} (fixes \eqn{\lambda = 1}).}
\item{\code{"kkw"}}{Kumaraswamy-Kumaraswamy. Parameters:
\eqn{\alpha, \beta, \delta, \lambda} (fixes \eqn{\gamma = 1}).}
\item{\code{"ekw"}}{Exponentiated Kumaraswamy. Parameters:
\eqn{\alpha, \beta, \lambda} (fixes \eqn{\gamma = 1, \delta = 0}).}
\item{\code{"mc"}}{McDonald (Beta Power). Parameters:
\eqn{\gamma, \delta, \lambda} (fixes \eqn{\alpha = 1, \beta = 1}).}
\item{\code{"kw"}}{Kumaraswamy. Parameters: \eqn{\alpha, \beta}
(fixes \eqn{\gamma = 1, \delta = 0, \lambda = 1}).}
\item{\code{"beta"}}{Beta distribution. Parameters: \eqn{\gamma, \delta}
(fixes \eqn{\alpha = 1, \beta = 1, \lambda = 1}). Corresponds to
\code{shape1 = \eqn{\gamma}}, \code{shape2 = \eqn{\delta}}.}
}}

\item{link}{Specifies the link function(s) for the distributional parameters.
Can be a single character string (applied to all parameters) or a
named list for parameter-specific links (e.g.,
\code{link = list(alpha = "log", delta = "logit")}).

If \code{NULL} (default), links are: \code{"log"} for \eqn{\alpha, \beta,
  \gamma, \lambda} and \code{"logit"} for \eqn{\delta}.

Available links:
\describe{
\item{\code{"log"}}{Log link, maps \eqn{(0, \infty) \to R}. Ensures positivity.}
\item{\code{"logit"}}{Logit link, maps \eqn{(0, 1) \to R}.}
\item{\code{"probit"}}{Probit link, maps \eqn{(0, 1) \to R}.}
\item{\code{"cloglog"}}{Complementary log-log link, maps \eqn{(0, 1) \to R}.}
\item{\code{"cauchy"}}{Cauchy link, maps \eqn{(0, 1) \to R}.}
\item{\code{"identity"}}{Identity link (no transformation). Use with
caution as it does not enforce parameter constraints.}
\item{\code{"sqrt"}}{Square root link, maps \eqn{x \to \sqrt{x}}.}
\item{\code{"inverse"}}{Inverse link, maps \eqn{x \to 1/x}.}
\item{\code{"inverse-square"}}{Inverse squared link, maps \eqn{x \to 1/x^2}.}
}}

\item{link_scale}{Numeric scale factor(s) for link functions. Can be a
single numeric value (applied to all) or a named list.
Default is \code{NULL}, which uses \code{10} for \eqn{\alpha, \beta,
  \gamma, \lambda} and \code{1} for \eqn{\delta}. Smaller scales produce
steeper response curves; larger scales produce more gradual ones.}

\item{subset}{Optional vector specifying a subset of observations.}

\item{weights}{Optional numeric vector of prior weights. Currently experimental.}

\item{offset}{Optional vector or matrix specifying an \emph{a priori} known
component to be included in the linear predictor(s). Offsets are added
\emph{before} the link function is applied.}

\item{na.action}{A function specifying how to handle \code{NA}s.
Defaults to \code{getOption("na.action")}. See
\code{\link[stats]{na.omit}} and \code{\link[stats]{na.exclude}}.}

\item{contrasts}{Optional list specifying contrasts for factor variables.
See \code{\link[stats]{contrasts}} and \code{contrasts.arg} in
\code{\link[stats]{model.matrix}}.}

\item{control}{A list of control parameters from \code{\link{gkw_control}}
specifying optimization details (e.g., \code{method}, \code{start},
\code{hessian}, \code{maxit}). See \code{\link{gkw_control}} for all
options and defaults.}

\item{model}{Logical (default \code{TRUE}). If \code{TRUE}, the model frame
is returned as component \code{model}.}

\item{x}{Logical (default \code{FALSE}). If \code{TRUE}, the list of
model matrices (one for each modeled parameter) is returned as component \code{x}.}

\item{y}{Logical (default \code{TRUE}). If \code{TRUE}, the response
vector is returned as component \code{y}.}

\item{...}{Arguments for backward compatibility (e.g., \code{method},
\code{start}, \code{hessian}, \code{silent}). These are deprecated and
should be passed via the \code{control} argument. Using them will
trigger a warning.}
}
\value{
An object of class \code{"gkwreg"}, a list containing:

\strong{Model Specification:}
\describe{
\item{\code{call}}{The matched function call.}
\item{\code{formula}}{The \code{Formula} object used.}
\item{\code{family}}{The distribution family used.}
\item{\code{link}}{Named list of link functions used.}
\item{\code{link_scale}}{Named list of link scale values.}
\item{\code{control}}{The \code{gkw_control} object used.}
}

\strong{Parameter Estimates:}
\describe{
\item{\code{coefficients}}{Named vector of estimated regression
coefficients (on the link scale).}
\item{\code{fitted_parameters}}{Named list of mean parameter values
(e.g., \eqn{\alpha, \beta}) averaged across observations.}
\item{\code{parameter_vectors}}{Named list of observation-specific
parameter vectors (e.g., \code{alphaVec}, \code{betaVec}).}
}

\strong{Fitted Values and Residuals:}
\describe{
\item{\code{fitted.values}}{Vector of fitted mean values \eqn{E[Y|X]}.}
\item{\code{residuals}}{Vector of response residuals (observed - fitted).}
}

\strong{Inference:} (Only if \code{control$hessian = TRUE})
\describe{
\item{\code{vcov}}{Variance-covariance matrix of coefficients.}
\item{\code{se}}{Vector of standard errors of coefficients.}
}

\strong{Model Fit Statistics:}
\describe{
\item{\code{loglik}}{Maximized log-likelihood.}
\item{\code{aic}}{Akaike Information Criterion.}
\item{\code{bic}}{Bayesian Information Criterion.}
\item{\code{deviance}}{Deviance (-2 * loglik).}
\item{\code{df.residual}}{Residual degrees of freedom (nobs - npar).}
\item{\code{nobs}}{Number of observations.}
\item{\code{npar}}{Total number of estimated parameters.}
}

\strong{Diagnostic Statistics:}
\describe{
\item{\code{rmse}}{Root Mean Squared Error.}
\item{\code{efron_r2}}{Efron's pseudo R-squared.}
\item{\code{mean_absolute_error}}{Mean Absolute Error.}
}

\strong{Optimization Details:}
\describe{
\item{\code{convergence}}{Logical, \code{TRUE} if converged.}
\item{\code{message}}{Convergence message from optimizer.}
\item{\code{iterations}}{Number of optimizer iterations.}
}

\strong{Optional Components:}
\describe{
\item{\code{model}}{The model frame (if \code{model = TRUE}).}
\item{\code{x}}{List of model matrices (if \code{x = TRUE}).}
\item{\code{y}}{The response vector (if \code{y = TRUE}).}
}

\strong{Internal:}
\describe{
\item{\code{tmb_object}}{The raw object from \code{\link[TMB]{MakeADFun}}.}
}
}
\description{
Fits regression models for response variables strictly bounded in the (0, 1)
interval using the Generalized Kumaraswamy (GKw) family of distributions.
It provides a unified interface for fitting the GKw and six nested submodels,
allowing flexible regression on multiple distribution parameters.
}
\details{
Estimation is performed via Maximum Likelihood using automatic differentiation
through the TMB (Template Model Builder) package for efficiency and accuracy.
The modeling interface uses \code{\link[Formula]{Formula}} syntax, similar to
\code{\link[stats]{glm}} and \code{\link[betareg]{betareg}}, allowing different
linear predictors for each distributional parameter.

\subsection{Distribution Families}{
The \code{family} argument selects a distribution from the GKw hierarchy.
Simpler families (\code{"beta"}, \code{"kw"}) are often sufficient and
computationally faster. More complex families (\code{"bkw"}, \code{"gkw"})
add flexibility but risk overfitting. Use \code{\link[stats]{AIC}},
\code{\link[stats]{BIC}}, or \code{\link{anova.gkwreg}} to compare nested models.
}

\subsection{Formula Specification}{
The extended formula syntax \code{y ~ model_alpha | model_beta | ...} allows
each parameter's linear predictor to be specified. Parameters are in the
order \eqn{\alpha, \beta, \gamma, \delta, \lambda}.

If a part is omitted (e.g., \code{y ~ model_alpha}), the remaining parameters
are modeled as intercept-only. Parts corresponding to fixed parameters
(defined by \code{family}) are ignored.

\preformatted{
# Kw family ("kw") parameters: alpha, beta

# alpha ~ x1 + x2, beta ~ x3
y ~ x1 + x2 | x3

# alpha ~ x1, beta ~ 1 (intercept only)
y ~ x1 | 1

# alpha ~ x1, beta ~ x1 (same formula for both)
y ~ x1
}
}

\subsection{Optimization and Convergence}{
Fitting is performed by \code{\link[stats]{optim}} or \code{\link[stats]{nlminb}}.
If convergence fails, consider:
\itemize{
\item Checking data for separation, outliers, or collinearity.
\item Rescaling predictors.
\item Trying a different optimizer, e.g.,
\code{control = gkw_control(method = "BFGS")}.
\item Simplifying the model (fewer predictors or a simpler \code{family}).
\item Providing starting values via \code{control = gkw_control(start = ...)}.
}
}
}
\examples{
\donttest{
# SECTION 1: Basic Usage - Getting Started
# Load packages and data
library(gkwreg)
library(gkwdist)
data(GasolineYield)

# Example 1.1: Simplest possible model (intercept-only, all defaults)
fit_basic <- gkwreg(yield ~ 1, data = GasolineYield, family = "kw")
summary(fit_basic)

# Example 1.2: Model with predictors (uses all defaults)
# Default: family = "gkw", method = "nlminb", hessian = TRUE
fit_default <- gkwreg(yield ~ batch + temp, data = GasolineYield)
summary(fit_default)

# Example 1.3: Kumaraswamy model (two-parameter family)
# Default link functions: log for both alpha and beta
fit_kw <- gkwreg(yield ~ batch + temp, data = GasolineYield, family = "kw")
summary(fit_kw)
plot(fit_kw, ask = FALSE, use_ggplot = TRUE, arrange_plots = TRUE)

# Example 1.4: Beta model for comparison
# Default links: log for gamma and delta
fit_beta <- gkwreg(yield ~ batch + temp, data = GasolineYield, family = "beta")

# Compare models using AIC/BIC
AIC(fit_kw, fit_beta)
BIC(fit_kw, fit_beta)

# SECTION 2: Using gkw_control() for Customization
# Example 2.1: Change optimization method to BFGS
fit_bfgs <- gkwreg(
  yield ~ batch + temp,
  data = GasolineYield,
  family = "kw",
  control = gkw_control(method = "BFGS")
)
summary(fit_bfgs)

# Example 2.3: Fast fitting without standard errors
# Useful for model exploration or large datasets
fit_fast <- gkwreg(
  yield ~ batch + temp,
  data = GasolineYield,
  family = "kw",
  control = gkw_control(hessian = FALSE)
)
# Note: Cannot compute confint() without hessian
coef(fit_fast) # Point estimates still available

# SECTION 3: Advanced Formula Specifications
# Example 3.1: Different predictors for different parameters
# alpha depends on batch, beta depends on temp
fit_diff <- gkwreg(
  yield ~ batch | temp,
  data = GasolineYield,
  family = "kw"
)
summary(fit_diff)

# Example 3.2: Intercept-only for one parameter
# alpha varies with predictors, beta is constant
fit_partial <- gkwreg(
  yield ~ batch + temp | 1,
  data = GasolineYield,
  family = "kw"
)

# Example 3.3: Complex model with interactions
fit_interact <- gkwreg(
  yield ~ batch * temp | temp + I(temp^2),
  data = GasolineYield,
  family = "kw"
)

# SECTION 4: Working with Different Families
# Example 4.1: Fit multiple families and compare
families <- c("beta", "kw", "ekw", "bkw", "gkw")
fits <- lapply(families, function(fam) {
  gkwreg(yield ~ batch + temp, data = GasolineYield, family = fam)
})
names(fits) <- families

# Compare via information criteria
comparison <- data.frame(
  Family = families,
  LogLik = sapply(fits, logLik),
  AIC = sapply(fits, AIC),
  BIC = sapply(fits, BIC),
  npar = sapply(fits, function(x) x$npar)
)
print(comparison)

# Example 4.2: Formal nested model testing
fit_kw <- gkwreg(yield ~ batch + temp, GasolineYield, family = "kw")
fit_ekw <- gkwreg(yield ~ batch + temp, GasolineYield, family = "ekw")
fit_gkw <- gkwreg(yield ~ batch + temp, GasolineYield, family = "gkw")
anova(fit_kw, fit_ekw, fit_gkw)

# SECTION 5: Link Functions and Scales
# Example 5.1: Custom link functions
fit_links <- gkwreg(
  yield ~ batch + temp,
  data = GasolineYield,
  family = "kw",
  link = list(alpha = "sqrt", beta = "log")
)

# Example 5.2: Custom link scales
# Smaller scale = steeper response curve
fit_scale <- gkwreg(
  yield ~ batch + temp,
  data = GasolineYield,
  family = "kw",
  link_scale = list(alpha = 5, beta = 15)
)

# SECTION 6: Prediction and Inference
# Fit model for prediction examples
fit <- gkwreg(yield ~ batch + temp, GasolineYield, family = "kw")

# Example 6.1: Confidence intervals
confint(fit, level = 0.95) # 95\% CI

# SECTION 7: Diagnostic Plots and Model Checking
fit <- gkwreg(yield ~ batch + temp, GasolineYield, family = "kw")

# Example 7.1: All diagnostic plots (default)
plot(fit, ask = FALSE, use_ggplot = TRUE, arrange_plots = TRUE)

# Example 7.2: Select specific plots
plot(fit, which = c(2, 4, 5), use_ggplot = TRUE, arrange_plots = TRUE)

# SECTION 8: Real Data Example - Food Expenditure
# Load and prepare data
data(FoodExpenditure, package = "betareg")
food_data <- FoodExpenditure
food_data$prop <- food_data$food / food_data$income

# Example 8.1: Basic model
fit_food <- gkwreg(
  prop ~ persons | income,
  data = food_data,
  family = "kw"
)
summary(fit_food)

# Example 8.2: Compare with Beta regression
fit_food_beta <- gkwreg(
  prop ~ persons | income,
  data = food_data,
  family = "beta"
)

# Which fits better?
AIC(fit_food, fit_food_beta)

# Example 8.3: Interpretation via effects
income_seq <- seq(min(food_data$income), max(food_data$income), length = 50)
pred_data <- data.frame(
  persons = median(food_data$persons),
  income = income_seq
)
pred_food <- predict(fit_food, newdata = pred_data, type = "response")

plot(food_data$income, food_data$prop,
     xlab = "Income", ylab = "Proportion Spent on Food",
     main = "Food Expenditure Pattern"
)
lines(income_seq, pred_food, col = "red", lwd = 2)

# SECTION 9: Simulation Studies
# Example 9.1: Simple Kumaraswamy simulation
set.seed(123)
n <- 500
x1 <- runif(n, -2, 2)
x2 <- rnorm(n)

# True model: log(alpha) = 0.8 + 0.3*x1, log(beta) = 1.2 - 0.2*x2
eta_alpha <- 0.8 + 0.3 * x1
eta_beta <- 1.2 - 0.2 * x2
alpha_true <- exp(eta_alpha)
beta_true <- exp(eta_beta)

# Generate response
y <- rkw(n, alpha = alpha_true, beta = beta_true)
sim_data <- data.frame(y = y, x1 = x1, x2 = x2)

# Fit and check parameter recovery
fit_sim <- gkwreg(y ~ x1 | x2, data = sim_data, family = "kw")

# Compare estimated vs true coefficients
cbind(
  True = c(0.8, 0.3, 1.2, -0.2),
  Estimated = coef(fit_sim),
  SE = fit_sim$se
)

# SECTION 10: Memory and Performance Optimization

# Example 10.1: Minimal object for large datasets
fit_minimal <- gkwreg(
  yield ~ batch + temp,
  data = GasolineYield,
  family = "kw",
  model = FALSE, # Don't store model frame
  x = FALSE,     # Don't store design matrices
  y = FALSE,     # Don't store response
  control = gkw_control(hessian = FALSE) # Skip Hessian
)

# Much smaller object
object.size(fit_minimal)

# Trade-off: Limited post-fitting capabilities
# Can still use: coef(), logLik(), AIC(), BIC()
# Cannot use: predict(), some diagnostics

# SECTION 11: Model Selection and Comparison

# Example 11.1: Nested model testing
fit1 <- gkwreg(yield ~ 1, GasolineYield, family = "kw")
fit2 <- gkwreg(yield ~ batch, GasolineYield, family = "kw")
fit3 <- gkwreg(yield ~ batch + temp, GasolineYield, family = "kw")

# Likelihood ratio tests
anova(fit1, fit2, fit3)
}
}
\references{
\strong{Generalized Kumaraswamy Distribution:}

Cordeiro, G. M., & de Castro, M. (2011). A new family of generalized distributions.
\emph{Journal of Statistical Computation and Simulation}, \strong{81}(7), 883-898.
\doi{10.1080/00949650903530745}

\strong{Kumaraswamy Distribution:}

Kumaraswamy, P. (1980). A generalized probability density function for
double-bounded random processes. \emph{Journal of Hydrology}, \strong{46}(1-2), 79-88.
\doi{10.1016/0022-1694(80)90036-0}

Jones, M. C. (2009). Kumaraswamy's distribution: A beta-type distribution with
some tractability advantages. \emph{Statistical Methodology}, \strong{6}(1), 70-81.
\doi{10.1016/j.stamet.2008.04.001}

\strong{Beta Regression:}

Ferrari, S. L. P., & Cribari-Neto, F. (2004). Beta regression for modelling
rates and proportions. \emph{Journal of Applied Statistics}, \strong{31}(7), 799-815.
\doi{10.1080/0266476042000214501}

\strong{Template Model Builder (TMB):}

Kristensen, K., Nielsen, A., Berg, C. W., Skaug, H., & Bell, B. M. (2016).
TMB: Automatic Differentiation and Laplace Approximation. \emph{Journal of
Statistical Software}, \strong{70}(5), 1-21.
\doi{10.18637/jss.v070.i05}
}
\seealso{
\strong{Core Functions:}
\code{\link{gkw_control}} for fitting options.

\strong{S3 Methods:}
\code{\link{summary.gkwreg}}, \code{\link{print.gkwreg}},
\code{\link{plot.gkwreg}}, \code{\link{predict.gkwreg}},
\code{\link{residuals.gkwreg}}, \code{\link{coef.gkwreg}},
\code{\link{vcov.gkwreg}}, \code{\link{logLik.gkwreg}},
\code{\link{confint.gkwreg}}, \code{\link{anova.gkwreg}}

\strong{Distributions:}
\code{\link[gkwdist]{dgkw}}, \code{\link[gkwdist]{pgkw}},
\code{\link[gkwdist]{qgkw}}, \code{\link[gkwdist]{rgkw}}

\strong{Related Packages:}
\code{\link[betareg]{betareg}}, \code{\link[Formula]{Formula}},
\code{\link[TMB]{TMB}}
}
\author{
Lopes, J. E.

Maintainer: Lopes, J. E.
}
\keyword{models}
\keyword{regression}
