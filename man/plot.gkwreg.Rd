% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/gkwreg.R
\name{plot.gkwreg}
\alias{plot.gkwreg}
\title{Diagnostic Plots for gkwreg Objects}
\usage{
\method{plot}{gkwreg}(
  x,
  which = 1:6,
  caption = c("Residuals vs. Observation Indices", "Cook's Distance Plot",
    "Generalized Leverage vs. Fitted Values", "Residuals vs. Linear Predictor",
    "Half-Normal Plot of Residuals", "Predicted vs. Observed Values"),
  sub.caption = paste(deparse(x$call), collapse = "\\n"),
  main = "",
  ask = prod(par("mfcol")) < length(which) && dev.interactive(),
  ...,
  type = c("quantile", "pearson", "deviance"),
  nsim = 100,
  level = 0.9,
  use_ggplot = FALSE,
  arrange_plots = FALSE,
  sample_size = NULL,
  theme_fn = ggplot2::theme_minimal,
  save_diagnostics = FALSE
)
}
\arguments{
\item{x}{A fitted model object of class \code{"gkwreg"}.}

\item{which}{Integer vector specifying which diagnostic plots to produce.
Valid values are from 1 to 6, corresponding to:
\enumerate{
\item Residuals vs. Observation Indices.
\item Cook's Distance Plot.
\item Generalized Leverage vs. Fitted Values.
\item Residuals vs. Linear Predictor.
\item Half-Normal Plot of Residuals.
\item Predicted vs. Observed Values.
}}

\item{caption}{A character vector of captions for the plots. Its length must be at
least \code{max(which)}.}

\item{sub.caption}{A character string for a common subtitle above the plots (e.g.,
the original call of the model). Defaults to the deparsed call of \code{x}.}

\item{main}{An optional character string to be used as the main title for each plot,
appended to the respective caption.}

\item{ask}{Logical; if \code{TRUE}, the user is prompted before each plot (only applicable
to base R graphics). Defaults to \code{TRUE} when the number of plots exceeds the current
graphics layout.}

\item{...}{Additional graphical parameters to be passed to the underlying plotting functions.}

\item{type}{Character string indicating the type of residual to be used.
Valid options are:
\itemize{
\item \code{"quantile"}: Quantile residuals, based on the probability integral transform.
Recommended for bounded response variables like those in GKw regression.
\item \code{"pearson"}: Pearson residuals, standardized by the estimated standard deviation.
Useful for identifying heteroscedasticity.
\item \code{"deviance"}: Deviance residuals, based on the contribution to the deviance.
Helpful for assessing model fit quality.
}
Defaults to \code{"quantile"}.}

\item{nsim}{Integer; number of simulations for the half-normal plot envelope.
Must be a positive integer. Defaults to 100.}

\item{level}{Numeric; confidence level for the half-normal plot envelope.
Must be between 0 and 1. Defaults to 0.90.}

\item{use_ggplot}{Logical; if \code{TRUE}, ggplot2 is used for plotting, otherwise base R
graphics are used. Defaults to \code{FALSE}.}

\item{arrange_plots}{Logical; if \code{TRUE} and \code{use_ggplot = TRUE}, attempts to
arrange multiple plots in a grid using \code{gridExtra::grid.arrange} or
\code{ggpubr::ggarrange}. Defaults to \code{FALSE}.}

\item{sample_size}{Integer or NULL; if provided and less than the number of observations,
a random sample of observations of this size will be used for plotting. Useful for very
large datasets. Defaults to NULL (use all observations).}

\item{theme_fn}{Function; a ggplot2 theme function to be applied to all plots when
\code{use_ggplot = TRUE}. Defaults to \code{ggplot2::theme_minimal()}.}

\item{save_diagnostics}{Logical; if \code{TRUE}, returns a list with the diagnostic
measures used for plotting. Defaults to \code{FALSE}.}
}
\value{
Invisibly returns either the fitted model object \code{x} (if \code{save_diagnostics = FALSE})
or a list containing the diagnostic measures (if \code{save_diagnostics = TRUE}).
}
\description{
This S3 method produces a set of diagnostic plots for a fitted Generalized
Kumaraswamy (GKw) regression model, as returned by \code{\link{gkwreg}}.
The function provides standard plots for residual analysis, influence measures,
and goodness-of-fit assessment. Users may choose between base R graphics or
ggplot2 for plotting.
}
\details{
The diagnostic plots generated by this function are similar in spirit to those used in
beta regression models and other regression models for variables with bounded support.

\subsection{Residual Types}{
The choice of residual type affects the interpretation of the diagnostic plots:
\itemize{
\item \strong{Quantile Residuals}: Based on the probability integral transform as described
in Dunn & Smyth (1996). These residuals are particularly useful for bounded response
variables as in the GKw regression, as they tend to be more normally distributed than
other types of residuals. Recommended as the default choice.
\item \strong{Pearson Residuals}: These are standardized residuals computed as the
difference between observed and fitted values, divided by the estimated standard
deviation of the observations. Useful for detecting heteroscedasticity but may not
be normally distributed in GKw models.
\item \strong{Deviance Residuals}: These are based on the contribution of each
observation to the deviance statistic, similar to those in generalized linear models.
They help assess overall model fit and identify outliers.
}
}

\subsection{Cook's Distance}{
Cook's distance (Cook, 1977) is a measure of the influence of each observation on the fitted model.
In this implementation, it is calculated using a generalized formula based on residuals and
leverage values:

\deqn{D_i = \frac{r_i^2}{p \cdot MSE} \cdot \frac{h_ii}{(1 - h_ii)^2}}

where \eqn{r_i} are the residuals, \eqn{p} is the number of parameters, \eqn{MSE} is the
mean squared error, and \eqn{h_ii} are estimates of the generalized leverage.

Values exceeding \eqn{4/n} (where \eqn{n} is the sample size) are often considered influential
(Fox, 2016).
}

\subsection{Generalized Leverage}{
Generalized leverage quantifies the influence of the response values on the fitted values.
For non-linear models like GKw regression, the diagonal elements of a generalized hat matrix
are used, approximated here as the ratio of parameters to sample size (\eqn{p/n}).

Values exceeding \eqn{2p/n} may indicate high leverage points worth investigating
(Belsley, Kuh & Welsch, 1980).
}

\subsection{Half-Normal Plot}{
The half-normal plot displays the absolute residuals against the theoretical quantiles
of a half-normal distribution. A simulation-based envelope is provided to help assess
whether the observed pattern of residuals is consistent with the fitted model.
Points falling outside the envelope suggest potential model inadequacies.
}
}
\examples{
\dontrun{
# Generate example data
set.seed(123)
n <- 100
x1 <- runif(n, -1, 1)
x2 <- runif(n, -1, 1)

# Generate parameters
alpha <- 1 + 0.5 * x1
beta <- 2 + 0.3 * x2
gamma <- 1
delta <- 1
lambda <- 1

# Generate response from GKw distribution
u <- runif(n)
y <- (1 - (1 - (1 - (1 - u)^(1 / lambda))^(1 / delta))^(1 / gamma))^(1 / beta)
y <- y^(1 / alpha)

# Create data frame
mydata <- data.frame(y = y, x1 = x1, x2 = x2)

# Fit a GKw regression model
fit <- gkwreg(y ~ x1 | x2 | 1 | 1 | 1, data = mydata)

# Basic diagnostic plots using base R graphics
plot(fit, which = 1:4, type = "pearson")

# Produce all diagnostic plots using ggplot2
plot(fit, which = 1:6, use_ggplot = TRUE)

# Arrange multiple plots in a grid
plot(fit, which = 1:4, use_ggplot = TRUE, arrange_plots = TRUE)

# Use a custom ggplot2 theme
plot(fit,
  which = 1:6, use_ggplot = TRUE,
  theme_fn = ggplot2::theme_dark()
)

# Extract diagnostic measures for further analysis
diag_data <- plot(fit, which = 1:6, save_diagnostics = TRUE)

# Create a custom diagnostic plot
if (requireNamespace("ggplot2", quietly = TRUE)) {
  ggplot2::ggplot(diag_data, ggplot2::aes(x = cook_dist, y = leverage)) +
    ggplot2::geom_point() +
    ggplot2::labs(
      x = "Cook's Distance", y = "Leverage",
      title = "Influence Diagnostic Plot"
    )
}
}

}
\references{
Belsley, D. A., Kuh, E., & Welsch, R. E. (1980). \emph{Regression Diagnostics: Identifying
Influential Data and Sources of Collinearity}. Wiley.

Cook, R. D. (1977). Detection of Influential Observations in Linear Regression.
\emph{Technometrics}, 19(1), 15-18.

Dunn, P. K., & Smyth, G. K. (1996). Randomized Quantile Residuals.
\emph{Journal of Computational and Graphical Statistics}, 5(3), 236-244.

Fox, J. (2016). \emph{Applied Regression Analysis and Generalized Linear Models}.
Third Edition. Sage.
}
\seealso{
\code{\link{gkwreg}}, \code{\link[ggplot2]{ggplot}}, \code{\link[stats]{qqnorm}}
}
